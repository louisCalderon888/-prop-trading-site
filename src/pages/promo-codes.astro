---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import PromoCard from '../components/PromoCard.astro';
import propFirms from '../data/propfirms.json';

const title = "Active Prop Trading Promo Codes 2026 | Verified Discounts";
const description = "Save up to 80% with verified prop trading promo codes. List of active coupons for Apex Trader Funding, TopStep, Bulenox, and more.";

// Filter only firms with discounts or codes
const firmsWithOffers = propFirms.filter(firm => firm.discountValue > 0 || firm.code);

const offerSchema = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  "itemListElement": firmsWithOffers.map((firm, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "item": {
      "@type": "Offer",
      "name": `${firm.discount} at ${firm.name}`,
      "description": `Get ${firm.discount} on ${firm.name} evaluations with code ${firm.code || 'automatic discount'}.`,
      "url": firm.link
    }
  }))
};
---

<Layout title={title} description={description}>
  <script type="application/ld+json" set:html={JSON.stringify(offerSchema)} />
  
  <Header />
  
  <main>
    <section class="hero bg-slate-900/50 min-h-[40vh]">
      <div class="container text-center">
        <h1 class="mb-4">
          Active <span class="text-gradient">Promo Codes</span>
        </h1>
        <p class="subtitle mx-auto">
          We track and verify every promo code daily. Stop searching for "active codes" on Reddit. We have them all right here.
        </p>
      </div>
    </section>
    
    <section class="section">
      <div class="container">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {firmsWithOffers.map((firm) => (
            <PromoCard 
              name={firm.name}
              code={firm.code}
              discount={firm.discount}
              link={firm.link}
              isExclusive={firm.isExclusive}
              verified={firm.verified}
            />
          ))}
        </div>
      </div>
    </section>
    
    <section class="section bg-slate-900/50">
      <div class="container max-w-3xl text-center">
        <h2 class="mb-4">Never Pay Full Price Again</h2>
        <p class="text-gray-400 mb-8">
          Prop firms run flash sales constantly. Join our newsletter (coming soon) to get notified when 80-90% off sales drop.
        </p>
        
        <div class="p-4 bg-slate-800 rounded-lg border border-slate-700 inline-block">
          <p class="text-emerald-400 font-mono text-sm">
            Last Update: <span id="last-check"></span>
          </p>
        </div>
      </div>
    </section>
  </main>
  
  <Footer />
</Layout>

<script>
  const lastCheck = document.getElementById('last-check');
  if (lastCheck) {
    lastCheck.textContent = new Date().toLocaleDateString('en-US', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  }
</script>
